!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).VanillaCamera=n()}(this,function(){"use strict";var D=0<=["iPad","iPhone","iPod"].indexOf(navigator.platform),b=navigator&&navigator.mediaDevices&&"enumerateDevices"in navigator.mediaDevices;function w(n,e,o){navigator.mediaDevices.getUserMedia(e).then(function(e){n.srcObject=e,n.setAttribute("playsinline","true"),n.controls=!0,setTimeout(function(){n.controls=!1})}).catch(function(e){console.log("Error occurred ",e),o(e)})}function e(e,n){var o,t=void 0===n?{}:n,i=t.onError,a=void 0===i?function(){}:i,r=t.size,d=void 0===r?1:r,c=t.area,u=void 0===c?1:c,v=t.square;if(o="string"==typeof e?document.querySelector(e):e,!document.contains(o))return console.error("document.contains no found target"),void a("document.contains no found target");var s=document.createElement("video");s.width=o.clientWidth,s.height=o.clientHeight,s.controls=!1,s.style.background="#000",s.muted=!0,o.append(s),s.autoplay=!0,function(t,i){b&&navigator.mediaDevices.enumerateDevices().then(function(e){var n,o=e.filter(function(e){if("videoinput"==e.kind)return e});1<o.length?(n={video:{mandatory:{sourceId:o[o.length-1].deviceId?o[o.length-1].deviceId:null}},audio:!1},D&&(n.video.facingMode="environment"),w(t,n,i)):o.length?(n={video:{mandatory:{sourceId:o[0].deviceId?o[0].deviceId:null}},audio:!1},D&&(n.video.facingMode="environment"),n.video.mandatory.sourceId||D?w(t,n,i):w(t,{video:!0},i)):w(t,{video:!0},i)}).catch(function(e){console.error("Error occurred : ",e)})}(s,a);var l=document.createElement("canvas"),f=l.getContext("2d"),m=0,g=0,h=0,p=0,y=0,I=0;return s.addEventListener("canplay",function(){var e=function(e){return[e.videoWidth||e.width,e.videoHeight||e.height]}(s),n=e[0],o=e[1];if(y=n*d,I=o*d,l.width=y,l.height=I,v){var t=n;o<n?(m=(n-o)/2,t=o):g=(o-n)/2,p=h=t}else h=n,p=o}),{video:s,canvas:l,context:f,remove:function(){s.pause(),s.remove(),l.remove(),s=void 0},playPause:function(){s.paused?s.play():s.pause()},screenshot:function(){if(s){var e=((1-u)*h+2)/2+m,n=((1-u)*p+2)/2+g,o=h*u,t=p*u;return f.drawImage(s,e,n,o,t,0,0,y,I),l.toDataURL("image/png")}}}}return window.VanillaCamera=e});
